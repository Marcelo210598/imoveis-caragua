# Snapshot - 2026-02-03

## O que foi feito hoje

### Litoral Norte Imoveis - Projeto criado do zero

Frontend completo em Next.js 14 para exibir imoveis do Litoral Norte de SP.

**Arquivos criados (26 arquivos):**

1. **Configuracao do projeto**
   - `package.json` - Next.js 14, React 18, lucide-react, recharts, clsx
   - `tsconfig.json` - TypeScript strict com path alias @/*
   - `tailwind.config.ts` - Cores custom: primary (azul), deal (verde/amarelo), sand
   - `next.config.js` - Remote patterns pra imagens do ZAP e VivaReal
   - `postcss.config.js`, `.gitignore`

2. **Types e Libs**
   - `types/property.ts` - Interfaces Property, PropertyFilters, CityStats
   - `lib/utils.ts` - formatPrice, formatArea, getDealColor, getDealLabel, etc
   - `lib/properties.ts` - getAllProperties, filterProperties, getTopDeals, getCityStats, getUniqueCities

3. **Componentes (8)**
   - `Header.tsx` - Nav sticky com blur, hamburger mobile
   - `Footer.tsx` - Links por cidade, info sobre dados
   - `PropertyCard.tsx` - Card com foto, preco, features, deal badge, source badge
   - `PropertyGrid.tsx` - Grid responsivo 1/2/3 colunas, empty state
   - `FilterSidebar.tsx` - Cidade, preco min/max, quartos, toggle "so oportunidades", mobile drawer
   - `DealBadge.tsx` - Badge com emoji fogo, verde (80+) ou amarelo (60-79)
   - `SearchBar.tsx` - Input com debounce 500ms
   - `PriceChart.tsx` - BarChart recharts comparativo (imovel vs media bairro)

4. **Pages (5)**
   - `app/page.tsx` - Homepage: hero gradient, cards por cidade, top 6 deals, stats
   - `app/imoveis/page.tsx` - Grid com filtros, paginacao "carregar mais", skeleton loading
   - `app/imoveis/[id]/page.tsx` - Detalhe: galeria, preco, features, chart, link externo
   - `app/deals/page.tsx` - So oportunidades (deal_score >= 60)
   - `app/layout.tsx` - Root layout com Header/Footer, Inter font, metadata SEO

5. **API Routes (2)**
   - `app/api/properties/route.ts` - GET com filtros (city, price, bedrooms, deals, search)
   - `app/api/property/[id]/route.ts` - GET por external_id

6. **Dados**
   - `data/properties.json` - 110 imoveis copiados do scraper

## Decisoes tecnicas importantes
- Dados copiados pra dentro do projeto (JSON em `data/properties.json`) pra funcionar no Vercel
- Server Components por padrao, Client Components so onde precisa (filtros, search, chart)
- useSearchParams wrappado em Suspense (requisito Next.js 14)
- Imagens do portal com tag `<img>` nativa (imagens externas com URLs variadas)
- Paginacao client-side com "carregar mais" (24 por pagina)

## Problemas encontrados e solucoes
- **Set spread nao compilava**: `[...new Set()]` deu erro de TypeScript, trocado por `Array.from(new Set())`
- **useSearchParams sem Suspense**: Next.js 14 exige Suspense boundary, refatorado imoveis/page.tsx
- **Path do JSON no Vercel**: `../litoral-norte-scraper/` nao existe no deploy, copiado pra `data/properties.json`
- **Deploy Vercel nao triggerou**: commits 2 e 3 nao geraram redeploy automatico, precisa redeploy manual

## Configuracoes adicionadas
- Projeto deployado no Vercel: https://imoveis-caragua.vercel.app/
- Repo GitHub: https://github.com/Marcelo210598/imoveis-caragua
- Dev server local: porta 3001 (3000 estava ocupada)

## Estado atual do projeto
- Build passando sem erros
- 110 imoveis carregados do JSON
- Todas as pages funcionando localmente
- Deploy no Vercel funcionando: https://imoveis-caragua.vercel.app/

---

## Sessao 2 - Fix flickering na listagem

### O que foi feito
- **Corrigido bug de flickering** na pagina /imoveis que fazia a tela piscar sem parar

### Causa raiz
Loop de re-renders causado por 3 problemas:
1. `SearchBar.tsx` - `useEffect` dependia de `onSearch` (funcao inline recriada a cada render) causando loop infinito
2. `FilterSidebar.tsx` - Inputs de preco disparavam fetch a cada tecla digitada
3. `page.tsx` - `useEffect` dependia do objeto `filters` por referencia, disparando fetches duplicados

### Solucoes aplicadas
1. **SearchBar**: `useRef` para callback + skip do primeiro render
2. **FilterSidebar**: Estado local para preco + debounce de 600ms
3. **page.tsx**: Serializacao de filtros (`filterKey`) + `AbortController` para cancelar fetches antigos

### Arquivos alterados
- `components/SearchBar.tsx`
- `components/FilterSidebar.tsx`
- `app/imoveis/page.tsx`

### Commit
- `fix: corrige flickering na listagem de imoveis` (2476f64)

## Proxima sessao (To-do)
- Melhorar imagens (fallback quando URL quebrada)
- Adicionar mais imoveis rodando scraper com scroll infinito
- Considerar conectar ao banco Neon em vez de JSON estatico
- SEO: adicionar mais metadata por pagina
- Performance: ISR (Incremental Static Regeneration) se dados mudarem frequentemente

## Observacoes importantes
- O JSON em `data/properties.json` eh uma copia estatica - precisa atualizar manualmente ou automatizar
- O projeto le dados server-side (fs.readFileSync) entao funciona com SSR/SSG mas nao com client-side puro
- 4 cidades: Caraguatatuba, Ubatuba, Ilhabela, Sao Sebastiao
- 6 oportunidades com deal_score >= 60 (3 com score >= 80)
